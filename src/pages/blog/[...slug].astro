---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }));
}

type Props = CollectionEntry<'blog'>;

const post = Astro.props;
const { Content } = await post.render();
---

<BaseLayout title={post.data.title} description={post.data.description}>
  <article class="mx-auto max-w-4xl px-4 py-16 sm:px-6 lg:px-8">
    <header class="mb-8">
      <div class="mb-4 flex items-center gap-x-4 text-sm text-gray-500">
        <time datetime={post.data.pubDate.toISOString()}>
          {post.data.pubDate.toLocaleDateString('ja-JP')}
        </time>
        {post.data.updatedDate && (
          <>
            <span>•</span>
            <time datetime={post.data.updatedDate.toISOString()}>
              更新: {post.data.updatedDate.toLocaleDateString('ja-JP')}
            </time>
          </>
        )}
        {post.data.category && (
          <>
            <span>•</span>
            <span class="rounded-full bg-gray-100 px-3 py-1">
              {post.data.category}
            </span>
          </>
        )}
      </div>
      <h1 class="text-4xl font-bold text-gray-900">{post.data.title}</h1>
      <p class="mt-4 text-lg text-gray-600">{post.data.description}</p>
      {post.data.tags && post.data.tags.length > 0 && (
        <div class="mt-4 flex flex-wrap gap-2">
          {post.data.tags.map((tag) => (
            <span class="inline-flex items-center rounded-full bg-indigo-100 px-3 py-1 text-sm font-medium text-indigo-800">
              {tag}
            </span>
          ))}
        </div>
      )}
    </header>

    {post.data.heroImage && (
      <div class="mb-8">
        <img
          src={post.data.heroImage}
          alt=""
          class="w-full rounded-lg"
        />
      </div>
    )}

    <div class="prose prose-lg prose-gray max-w-none">
      <Content />
    </div>

    <footer class="mt-16 border-t pt-8">
      <nav class="flex items-center justify-between">
        <a href="/blog" class="text-indigo-600 hover:text-indigo-500">
          ← ブログ一覧に戻る
        </a>
        <a 
          href={`https://github.com/arstella/tech.arstella.co.jp/edit/main/src/content/blog/${post.id}`}
          target="_blank"
          rel="noopener"
          class="text-gray-500 hover:text-gray-700"
        >
          GitHubで編集
        </a>
      </nav>
    </footer>
  </article>
</BaseLayout>