---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Pagination from '../../components/Pagination.astro';
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const allPosts = await getCollection('blog', ({ data }) => {
    return data.draft !== true;
  });
  
  const posts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
  
  return paginate(posts, { pageSize: 10 });
};

const { page } = Astro.props as { page: any };
const currentPage = page.currentPage;
---

<BaseLayout title={currentPage > 1 ? `Blog - ページ ${currentPage}` : 'Blog'} description="Arstella Inc.の技術ブログ記事一覧">
  <div class="mx-auto max-w-7xl px-4 py-12 sm:px-6 sm:py-16 lg:px-8 lg:py-20">
    <!-- ページヘッダー -->
    <div class="text-center mb-12 sm:mb-16">
      <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold" style="font-family: var(--font-heading); color: var(--color-gray-900); letter-spacing: -0.02em;">
        Blog
      </h1>
      <p class="mt-4 sm:mt-6 text-lg sm:text-xl text-gray-600 max-w-2xl mx-auto">
        技術的な知見や経験を共有しています
      </p>
    </div>

    <!-- 記事一覧 -->
    <div class="space-y-8 sm:space-y-12">
      {page.data.map((post: any) => (
        <article class="card-hover group">
          <div class="card-content space-normal">
            <div class="grid lg:grid-cols-4 gap-6 lg:gap-8">
              <!-- メタ情報とカテゴリ -->
              <div class="lg:col-span-1 space-snug">
                <div class="flex lg:flex-col gap-3 lg:gap-2">
                  <time datetime={post.data.pubDate.toISOString()} 
                        class="text-sm font-medium whitespace-nowrap" 
                        style="color: var(--color-gray-500);">
                    {post.data.pubDate.toLocaleDateString('ja-JP')}
                  </time>
                  {post.data.category && (
                    <a href={`/categories/${encodeURIComponent(post.data.category)}/`} 
                       class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium transition-all duration-200 hover:scale-105" 
                       style="background-color: var(--color-primary); color: white;">
                      {post.data.category}
                    </a>
                  )}
                </div>
              </div>
              
              <!-- メインコンテンツ -->
              <div class="lg:col-span-3 space-snug">
                <div class="space-tight">
                  <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold leading-tight" 
                      style="font-family: var(--font-heading); color: var(--color-gray-900);">
                    <a href={`/blog/${post.slug}`} class="link transition-colors duration-300">
                      {post.data.title}
                    </a>
                  </h2>
                  <p class="text-base sm:text-lg line-clamp-2" 
                     style="color: var(--color-gray-600); line-height: 1.6;">
                    {post.data.description}
                  </p>
                </div>
                
                <!-- タグ -->
                {post.data.tags && post.data.tags.length > 0 && (
                  <div class="flex flex-wrap gap-2">
                    {post.data.tags.map((tag: string) => (
                      <a href={`/tags/${encodeURIComponent(tag)}/`} class="tag-default">
                        #{tag}
                      </a>
                    ))}
                  </div>
                )}
                
                <!-- 続きを読むリンク -->
                <div class="pt-2">
                  <a href={`/blog/${post.slug}`} 
                     class="inline-flex items-center text-sm font-semibold link group/read">
                    続きを読む
                    <svg class="ml-2 h-4 w-4 transition-transform group-hover/read:translate-x-1" 
                         fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                    </svg>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </article>
      ))}
    </div>

    {/* ページネーション */}
    <Pagination page={page} baseUrl="/blog/" />
  </div>
</BaseLayout>